# Story: System Dashboard with Disk Status

## Status: Approved

## Story

As a user,
I want to see a comprehensive dashboard of my system status,
so that I can quickly understand disk utilization, activity, and system health.

## Acceptance Criteria

### Dashboard Overview
- [ ] Dashboard displays aggregate disk space (total/used/free)
- [ ] Individual disk status cards with space and power status
- [ ] Real-time disk I/O metrics (if available)
- [ ] Recent file activity summary
- [ ] Scan status and progress indicators
- [ ] Auto-refresh dashboard data
- [ ] Desktop-optimized layout and design

## Dev Notes

### Previous Story Insights
**From Story 1.1 - Application Bootstrap and Configuration:**
- Configuration system established with disk monitoring preferences
- PhysicalDisk model with user aliases and monitoring status

**From Story 1.2 - Physical Disk Discovery and Registration:**
- Disk space calculation (total, used, available) available
- Power status detection integrated with smartctl
- Disk metadata collection implemented

**From Story 1.3 - File System Scanning Engine:**
- File and folder inventory with complete metadata
- Scan progress tracking and status reporting
- Recent file activity data available through scan operations

### Data Models
**Dashboard Summary Model** [Derived from existing models]
- Aggregate data from PhysicalDisk, File, and Folder models
- No new database tables required - computed from existing data
- Real-time metrics calculated from system calls and database queries

**Recent Activity Model** [Source: architecture.md#Data Models]
- Purpose: Track recent file system changes and scan activity
- Derived from File model modification timestamps and scan history
- No separate table - computed from existing scan and file data

### API Specifications
**Dashboard API Endpoints** [Source: Epic 1 Technical Tasks]
- GET /api/v1/dashboard/summary - Aggregate system statistics
- GET /api/v1/dashboard/disks - Individual disk status and metrics
- GET /api/v1/dashboard/activity - Recent file activity and scan status
- GET /api/v1/dashboard/io-stats - Disk I/O metrics (if available)
- WebSocket endpoint for real-time updates: /ws/dashboard

### Component Specifications
**Dashboard UI Components** [Source: Epic 1 Technical Tasks]
- System overview card with total disk space and utilization
- Individual disk status cards in grid layout
- Recent activity timeline with file operations
- Scan status widget with progress indicators
- Real-time data refresh with loading states
- Desktop-optimized grid layout using Tailwind CSS [Source: architecture.md#Tech Stack]

### File Locations
**Backend Structure** [Source: architecture.md#Unified Project Structure]
- Dashboard service: `apps/backend/internal/service/dashboard.go`
- I/O metrics service: `apps/backend/internal/service/iostats.go`
- Dashboard API endpoints: `apps/backend/internal/api/dashboard.go`
- WebSocket handler: `apps/backend/internal/api/websocket.go`

**Frontend Structure** [Source: architecture.md#Unified Project Structure]
- Dashboard page: `apps/frontend/app/dashboard/page.tsx`
- Dashboard components: `apps/frontend/components/dashboard/`
- Real-time hooks: `apps/frontend/hooks/useDashboard.ts`
- Shared types: `packages/shared-types/dashboard.ts`

### Technical Constraints
**Performance**: Dashboard must load in < 2 seconds [Source: Epic 1 Success Criteria]
**Real-time Updates**: Auto-refresh without overwhelming the system
**Desktop Focus**: Optimized for desktop browser experience (1920x1080+ primary target)
**I/O Monitoring**: Optional feature - graceful degradation if unavailable
**Memory Usage**: Efficient data aggregation for large file counts

### Testing Requirements
**Backend Testing**: Unit tests for dashboard data aggregation and I/O metrics [Source: architecture.md#Tech Stack]
**Frontend Testing**: Component tests for all dashboard widgets and desktop layout behavior
**Integration Testing**: Real-time updates and WebSocket functionality
**Performance Testing**: Dashboard load time and data refresh performance

## Tasks / Subtasks

### Backend Implementation - Dashboard Data Service
- [ ] Create dashboard service for data aggregation (AC: 1)
  - [ ] Aggregate total/used/free space across all monitored disks
  - [ ] Calculate system-wide utilization percentages
- [ ] Implement individual disk metrics collection (AC: 2)
  - [ ] Collect disk space, power status, and metadata from Story 1.2
  - [ ] Add disk health indicators and status summaries
- [ ] Add recent activity tracking (AC: 4)
  - [ ] Query recent file modifications from File model
  - [ ] Aggregate scan activity and completion statistics
- [ ] Implement I/O metrics collection if available (AC: 3)
  - [ ] Use system calls to collect disk I/O statistics
  - [ ] Add graceful degradation when I/O stats unavailable
- [ ] Write unit tests for all dashboard data aggregation logic

### Backend Implementation - Dashboard API Endpoints
- [ ] Create GET /api/v1/dashboard/summary endpoint
  - [ ] Return aggregate disk space and system statistics
  - [ ] Include scan status and recent activity counts
- [ ] Create GET /api/v1/dashboard/disks endpoint
  - [ ] Return individual disk status cards with all metadata
  - [ ] Include power status, space usage, and monitoring status
- [ ] Create GET /api/v1/dashboard/activity endpoint
  - [ ] Return recent file activity timeline
  - [ ] Include scan history and completion status
- [ ] Create GET /api/v1/dashboard/io-stats endpoint for I/O metrics
- [ ] Add proper error handling and performance optimization
- [ ] Write unit tests for all dashboard API endpoints

### Backend Implementation - Real-time Updates
- [ ] Implement WebSocket handler for dashboard updates (AC: 6)
  - [ ] Set up WebSocket connection at /ws/dashboard
  - [ ] Push real-time updates for disk status changes
- [ ] Add periodic dashboard data refresh service
  - [ ] Configure refresh intervals for different data types
  - [ ] Optimize query performance for frequent updates
- [ ] Implement update broadcasting to connected clients
- [ ] Write integration tests for real-time update functionality

### Frontend Implementation - Dashboard Layout
- [ ] Create desktop-optimized dashboard page layout (AC: 7)
  - [ ] Use CSS Grid for desktop card arrangement
  - [ ] Implement desktop-first design (1920x1080+ target resolution)
- [ ] Create system overview summary card (AC: 1)
  - [ ] Display total disk space with visual indicators
  - [ ] Show system-wide utilization percentages
- [ ] Implement individual disk status cards (AC: 2)
  - [ ] Grid layout of disk cards with status indicators
  - [ ] Include disk space, power status, and monitoring status
- [ ] Add scan status and progress widget (AC: 5)
  - [ ] Display current scan progress if running
  - [ ] Show scan history and completion statistics
- [ ] Style all components with Tailwind CSS for desktop experience

### Frontend Implementation - Real-time Features
- [ ] Implement real-time data updates (AC: 6)
  - [ ] Create custom hook for WebSocket connection
  - [ ] Handle connection states and error recovery
- [ ] Add auto-refresh functionality with configurable intervals
- [ ] Create loading states and error handling for all dashboard sections
- [ ] Implement recent activity timeline component (AC: 4)
  - [ ] Display recent file changes and scan activities
  - [ ] Add timestamps and activity type indicators
- [ ] Add I/O metrics visualization if available (AC: 3)
  - [ ] Charts or graphs for disk I/O activity
  - [ ] Graceful degradation when metrics unavailable
- [ ] Write component tests for all dashboard features

### Integration & Quality
- [ ] Test complete dashboard functionality with multiple disks
- [ ] Verify real-time updates work correctly across all components
- [ ] Test desktop layout optimization on various desktop screen sizes (1920x1080, 2560x1440, ultrawide)
- [ ] Validate dashboard load time meets < 2 second requirement
- [ ] Test graceful degradation when I/O metrics unavailable
- [ ] Verify auto-refresh doesn't impact system performance
- [ ] Test error scenarios (disk unavailable, scan failures, WebSocket disconnection)
- [ ] Validate data accuracy across all dashboard components

## Definition of Done

- Dashboard provides clear overview of system status with aggregate and individual disk information
- Disk space and power status accurately displayed with real-time updates
- Dashboard updates automatically with fresh data without manual refresh
- Desktop-optimized design works smoothly on common desktop resolutions (1920x1080+)
- Dashboard loads in under 2 seconds with acceptable performance for multiple disks
- Recent activity and scan status properly displayed with accurate timestamps
- All tests pass (unit, integration, component, desktop layout)
- No critical bugs or performance issues during dashboard operation

## File List

*To be populated during implementation*

## Dev Agent Record

### Implementation Notes
*To be populated during development*

### Completion Notes
*To be populated upon completion*

### Debug Log References
*To be populated if debugging required*

## QA Results

*To be populated during QA review*
